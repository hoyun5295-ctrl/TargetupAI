# 직원 버그 리포트 5차 — 작업 목록 (2026-02-19)

## 작업 그룹 A: 광고성 메시지 (광고)+무료거부 처리 통합

### A-1. AI추천발송 미리보기에 (광고)+무료거부번호 누락 [버그]
- **증상**: 광고성 메시지 토글 ON 상태에서 문구 생성 후, 미리보기 카드에 `(광고)` 접두사와 `무료거부 080-XXX-XXXX` 하단 문구가 빠진 채 표시
- **바이트 카운트도 미반영**: 실제 발송 시 추가되는 바이트가 미리보기에 안 잡힘
- **수정 방향**: 미리보기 렌더링 시 is_ad=true이면 (광고) 접두 + 무료거부 접미를 포함하여 표시 + 바이트 계산에도 반영
- **관련 파일**: frontend 캠페인 생성 페이지 (AI 추천 메시지 미리보기 영역)

### A-2. 예약 건 수정 후 미리보기에서 (광고)+무료수신거부 이중 표기 + "무료수신거부 null" [버그]
- **증상**: 문안 수정 후 미리보기에서 `(광고) (광고) [시세이도]` 이중 접두 + 하단에 `무료수신거부 080-000-0000` / `무료수신거부 null` 두 줄 표시
- **원인 추정**: 이미 (광고)+무료거부가 포함된 본문(DB 저장값)에 프론트에서 다시 자동추가 + 080번호 null 처리 누락
- **수정 방향**: 
  1. 본문에 이미 (광고) 포함 여부 체크 → 중복 추가 방지
  2. 080번호가 null/빈값이면 무료수신거부 줄 자체를 표시하지 않음
  3. 근본적으로 DB 저장 시 (광고)+무료거부를 포함하여 저장하는지 vs 발송 시에만 붙이는지 정책 확인 필요
- **관련 파일**: frontend 예약대기 미리보기 + 문안수정 로직

---

## 작업 그룹 B: 담당자 테스트 발송

### B-1. [테스트] 접두사 완전 제거 → 본문 그대로 발송 [변경]
- **현재**: `[테스트] XXX님, (광고)[시세이도]...` 형태로 접두사 붙어서 발송
- **변경**: 접두사 완전 제거. 실제 수신자가 받을 메시지와 동일하게 발송
- **이유**: 테스트는 실제 메시지 확인이 목적. 접두사 때문에 바이트 초과/잘림/변형 발생
- **참고**: 발송 전 UI에서 "테스트 발송입니다" 안내만 표시하면 충분
- **관련 파일**: backend campaigns.ts (테스트 발송 로직), frontend 테스트 발송 버튼 영역

### B-2. 담당자 2명 등록인데 1명에게만 발송 [버그]
- **증상**: 담당자 사전수신 목록에 2명 등록, 상단 1명에게만 문자 발송
- **원인 추정**: 테스트 발송 루프에서 1건만 처리하거나 INSERT가 1건만 실행
- **관련 파일**: backend campaigns.ts (test-send 엔드포인트)

---

## 작업 그룹 C: KST 변환 누락

### C-1. 캠페인 확정 모달 예약시간 +9시간 표시 [버그]
- **증상**: 2/20 오후 5시 예약 → 확정 모달에 "2026. 2. 21. 오전 2:00:00" 표시
- **원인**: UTC 값을 KST 변환 없이 그대로 표시
- **참고**: 캘린더/예약대기 카드에서는 정상 → 확정 모달만 누락
- **관련 파일**: frontend 캠페인 확정 모달 컴포넌트

### C-2. 예약 시간변경 datetime picker에 -9시간 표시 [버그]
- **증상**: 오후 5시(17:00) 예약 건 → 시간변경 picker에 오전 8시(08:00) 표시
- **원인**: datetime input에 UTC 값 그대로 바인딩
- **관련 파일**: frontend 예약대기 시간변경 컴포넌트

---

## 작업 그룹 D: 개별 버그

### D-1. 고객DB 조회 초기화 버튼 동작 안 함 [버그]
- **증상**: 검색어/필터 설정 후 "초기화" 클릭해도 리셋 안 됨
- **관련 파일**: frontend 고객DB 조회 페이지

### D-2. 담당자 문의 메일 후 "플랜변경 신청 완료" 모달 표시 [버그]
- **증상**: 문의 메일 발송 성공 시 "플랜변경 신청 완료" 모달이 뜸
- **수정 방향**: "문의 접수 완료" 등 적절한 문구로 분기
- **관련 파일**: frontend 담당자 문의 페이지/모달

### D-3. 예약대기 문안수정 모달에서 기존 제목(subject) 누락 [버그]
- **증상**: 문안수정 클릭 시 제목 필드가 빈 상태 (본문은 정상 로드)
- **수정 방향**: 모달 open 시 campaign의 subject/message_subject 값 전달
- **관련 파일**: frontend 예약대기 문안수정 모달

---

## 작업 그룹 E: UI 개선

### E-1. 고객DB 전화번호 검색 매칭 개선 [개선]
- **현재**: LIKE '%5519%'로 중간 조합까지 매칭
- **요청**: 4자리 숫자 → 가운데 또는 뒷자리 단위로만 매칭
  - `5519` → `010-5519-****` 또는 `010-****-5519`만 매칭
- **관련 파일**: backend customers.ts (검색 쿼리), 가능하면 frontend도

### E-2. AI추천 미리보기 카드 텍스트 정렬 일관성 [개선]
- **증상**: 3개 카드(감성형/혜택강조형/MZ감성형) 텍스트 정렬 불일치, 이모지/구분선 넘침
- **관련 파일**: frontend AI추천 메시지 미리보기 카드 CSS

---

## 작업 순서 권장

1. **그룹 B** (담당자 테스트) — 접두사 제거 + 복수 발송 수정
2. **그룹 A** (광고성 메시지) — 미리보기 (광고)+무료거부 일원화
3. **그룹 C** (KST) — 확정모달 + 시간변경 picker
4. **그룹 D** (개별 버그) — 초기화, 문의모달, 제목누락
5. **그룹 E** (UI 개선) — 전화번호 검색, 카드 정렬
